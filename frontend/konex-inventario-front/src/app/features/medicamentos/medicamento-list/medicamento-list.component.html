<div class="flex justify-content-between align-items-center mb-3">
  <h2>Medicamentos</h2>
  <button pButton label="Nuevo medicamento" icon="pi pi-plus" (click)="nuevo()"></button>
</div>

<div class="flex gap-2 mb-3">
  <span class="p-input-icon-left">
    <i class="pi pi-search"></i>
    <input
      pInputText
      type="text"
      placeholder="Filtrar por nombre"
      [(ngModel)]="filtroNombre"
      (keyup.enter)="cargarMedicamentos()"
    />
  </span>
  <button pButton label="Buscar" icon="pi pi-search" (click)="cargarMedicamentos()"></button>
</div>

<p-table
  [value]="medicamentos"
  [paginator]="false"
  [rows]="pageSize"
  [loading]="loading"
  responsiveLayout="scroll"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Nombre</th>
      <th>Laboratorio</th>
      <th>F. Fabricaci√≥n</th>
      <th>F. Vencimiento</th>
      <th>Stock</th>
      <th>Valor unitario</th>
      <th style="width: 220px;">Acciones</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-med>
    <tr>
      <td>{{ med.nombre }}</td>
      <td>{{ med.laboratorio }}</td>
      <td>{{ med.fechaFabricacion | date }}</td>
      <td>{{ med.fechaVencimiento | date }}</td>
      <td>{{ med.cantidadStock }}</td>
      <td>{{ med.valorUnitario | currency:'COP':'symbol-narrow' }}</td>
      <td>
        <div class="flex gap-2">
          <button pButton icon="pi pi-shopping-cart" label="Vender" (click)="abrirVenta(med)"></button>
          <button pButton icon="pi pi-pencil" label="Editar" class="p-button-secondary" (click)="editar(med)"></button>
          <button pButton icon="pi pi-trash" label="Eliminar" class="p-button-danger" (click)="confirmarEliminar(med)"></button>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-paginator
  [rows]="pageSize"
  [totalRecords]="totalElements"
  [first]="page * pageSize"
  (onPageChange)="onPageChange($event)"
  class="mt-3"
></p-paginator>

<app-venta-dialog
  [(visible)]="ventaDialogVisible"
  [medicamento]="medicamentoSeleccionado"
  (ventaRealizada)="onVentaRealizada($event)"
></app-venta-dialog>

<p-confirmDialog></p-confirmDialog>
